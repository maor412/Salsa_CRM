# ייבוא תלמידים מ-Excel ל-Firebase

מדריך להעלאת רשימת תלמידים מקובץ Excel ישירות ל-Firestore.

---

## 📋 דרישות מוקדמות

### 1. קובץ Excel מוכן

קובץ Excel (`.xlsx` או `.xls`) עם העמודות הבאות:

| שם העמודה | סוג | חובה? | הערות |
|-----------|-----|-------|-------|
| **שם מלא** | טקסט | ✅ כן | שם התלמיד המלא |
| **תאריך לידה** | תאריך | ⚪ לא | פורמט: `DD/MM/YYYY` או `YYYY-MM-DD` |
| **טלפון** | טקסט/מספר | ⚪ לא | כל פורמט (הסקריפט ינקה אוטומטית) |

**דוגמה לטבלה ב-Excel:**

| שם מלא | תאריך לידה | טלפון |
|--------|------------|-------|
| דני כהן | 15/03/1995 | 0501234567 |
| שרה לוי | 22/07/1998 | 052-9876543 |
| יוסי אברהם | 01/12/1990 | 0547654321 |

### 2. קובץ Service Account ⚠️ חשוב!

⚠️ **הקובץ לא נמצא ב-Git מסיבות אבטחה!** אתה צריך להוריד אותו ידנית:

קובץ `serviceAccountKey.json` של Firebase:

1. כנס ל-[Firebase Console](https://console.firebase.google.com/)
2. בחר את הפרויקט שלך
3. לחץ על ⚙️ **Settings** > **Project settings**
4. עבור ללשונית **Service accounts**
5. לחץ על **Generate new private key**
6. שמור את הקובץ בשם `serviceAccountKey.json` בתיקיית `functions/`

⚠️ **חשוב:** קובץ זה מכיל מידע רגיש! אל תשתף אותו ואל תעלה אותו ל-Git!

---

## 🚀 התקנה

1. **פתח Terminal בתיקיית `functions/`:**
   ```bash
   cd functions
   ```

2. **התקן את החבילות הנדרשות:**
   ```bash
   npm install xlsx firebase-admin
   ```

---

## 📥 שימוש

### שלב 1: הכן את קובץ ה-Excel
- ודא שיש עמודה עם שם מלא (חובה)
- הוסף עמודות תאריך לידה וטלפון (אופציונלי)
- שמור את הקובץ

### שלב 2: העלה את התלמידים
```bash
node import-students.js ../path/to/your/students.xlsx
```

**דוגמה:**
```bash
node import-students.js ../data/students.xlsx
```

### שלב 3: בדוק את התוצאות
הסקריפט יציג:
- ✅ כל תלמיד שהתוסף בהצלחה
- ⏭️ שורות שדולגו (ריקות)
- ❌ שגיאות שנתקלו בהן
- 📊 סיכום סופי

---

## 🎯 מה הסקריפט עושה?

1. **קורא את קובץ ה-Excel** ומזהה אוטומטית את העמודות
2. **מנקה את נתוני הטלפון** - מוסיף +972 אוטומטית אם צריך
3. **ממיר תאריכים** מפורמטים שונים
4. **מעלה ל-Firestore** את כל התלמידים ב-batch אחד
5. **מדווח על הצלחה או שגיאות**

---

## 🔧 זיהוי אוטומטי של עמודות

הסקריפט מזהה אוטומטית שמות עמודות שונים:

### שם מלא:
- `שם מלא`, `שם`, `name`, `Name`, `full name`, `Full Name`, `fullName`

### תאריך לידה:
- `תאריך לידה`, `יום הולדת`, `birthday`, `Birthday`, `birth date`, `Birth Date`, `birthDate`

### טלפון:
- `טלפון`, `נייד`, `phone`, `Phone`, `mobile`, `Mobile`, `phoneNumber`, `phone number`

אם שמות העמודות שלך שונים, הסקריפט יציג את העמודות הזמינות ותוכל לשנות את השמות ב-Excel.

---

## 📊 שדות ב-Firestore

כל תלמיד יישמר עם השדות הבאים:

```javascript
{
  name: "דני כהן",              // שם מלא (חובה)
  phoneNumber: "+972501234567", // טלפון מנוקה
  birthday: Timestamp,           // תאריך לידה (אופציונלי)
  joinedAt: Timestamp,           // תאריך הצטרפות (אוטומטי - היום)
  isActive: true,                // פעיל (אוטומטי - true)
  notes: null                    // הערות (ריק בברירת מחדל)
}
```

---

## ⚠️ טיפים חשובים

1. **גיבוי:** לפני הייבוא, עשה גיבוי למסד הנתונים הקיים (אם יש)
2. **בדיקה:** נסה קודם עם קובץ קטן (3-5 תלמידים) לוודא שהכל עובד
3. **פורמט תאריכים:** Excel לפעמים משנה אוטומטית פורמט תאריכים - בדוק שזה נכון
4. **שורות ריקות:** הסקריפט ידלג אוטומטית על שורות ריקות
5. **טלפונים:** הסקריפט מתמודד עם פורמטים שונים:
   - `0501234567` → `+972501234567`
   - `052-9876543` → `+972529876543`
   - `+972547654321` → `+972547654321`

---

## 🐛 פתרון בעיות

### "לא נמצאה עמודת שם"
- בדוק ששם העמודה ב-Excel תואם לאחד מהשמות המזוהים
- או שנה את שם העמודה ב-Excel ל-"שם מלא"

### "הקובץ לא נמצא"
- ודא שהנתיב לקובץ נכון
- השתמש בנתיב יחסי מתיקיית `functions/`

### "שגיאת הרשאות Firebase"
- ודא שקובץ `serviceAccountKey.json` נמצא בתיקיית `functions/`
- ודא שהורדת את הקובץ הנכון מ-Firebase Console

### תאריכים לא מתפרשים נכון
- נסה לשנות את הפורמט ב-Excel ל-`DD/MM/YYYY`
- או ל-`YYYY-MM-DD`

---

## 🔒 אבטחה

- ⚠️ **אל תעלה** את `serviceAccountKey.json` ל-Git
- הקובץ כבר מוגדר ב-`.gitignore`
- אל תשתף את הקובץ הזה עם אף אחד

---

## 📝 דוגמה מלאה

```bash
# 1. עבור לתיקיית functions
cd functions

# 2. התקן חבילות (פעם אחת)
npm install xlsx firebase-admin

# 3. הורד את serviceAccountKey.json ושים בתיקייה
# (מ-Firebase Console)

# 4. הרץ את הסקריפט
node import-students.js ../students.xlsx

# פלט לדוגמה:
# 🔄 קורא את קובץ Excel...
# 📊 נמצאו 50 תלמידים בקובץ
# 📋 עמודות זמינות: [ 'שם מלא', 'תאריך לידה', 'טלפון' ]
# 🔍 מיפוי עמודות: { name: 'שם מלא', birthday: 'תאריך לידה', phone: 'טלפון' }
# ✅ 1. דני כהן - +972501234567 - 15/03/1995
# ✅ 2. שרה לוי - +972529876543 - 22/07/1998
# ...
# 🔄 שומר תלמידים ב-Firestore...
# ✅ הסתיים בהצלחה!
# ✅ 50 תלמידים נוספו
```

---

## 💡 שאלות נפוצות

**ש: האם הסקריפט מוחק תלמידים קיימים?**
ת: לא! הסקריפט רק מוסיף תלמידים חדשים.

**ש: מה קורה אם יש כפילויות?**
ת: הסקריפט יוסיף את כולם. אם אתה רוצה למנוע כפילויות, תצטרך להוסיף בדיקה לפי טלפון או שם.

**ש: אפשר להריץ את זה כמה פעמים?**
ת: כן, אבל זה יוסיף את אותם תלמידים שוב (כפילויות).

**ש: אפשר לעדכן תלמידים קיימים?**
ת: הסקריפט הנוכחי רק מוסיף. לעדכון תצטרך לשנות את הסקריפט.

---

## 📞 צריך עזרה?

אם יש בעיות, בדוק:
1. שהקובץ Excel בפורמט נכון
2. ש-`serviceAccountKey.json` במקום
3. שהתקנת את החבילות הנדרשות
4. את הודעות השגיאה בטרמינל
